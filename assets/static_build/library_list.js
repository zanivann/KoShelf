var V=class{constructor(){this.hasScrolled=!1;this.initialLoadProcessed=!1;this.setupScrollListener()}setupScrollListener(){let e=()=>{this.hasScrolled=!0,window.removeEventListener("scroll",e)};window.addEventListener("scroll",e,{passive:!0})}init(){let e=document.querySelectorAll(".lazy-image");e.forEach(t=>{t.classList.add("opacity-0"),t.removeAttribute("src")}),"IntersectionObserver"in window?this.setupIntersectionObserver(e):this.fallbackLoading(e)}setupIntersectionObserver(e){let t=new IntersectionObserver((n,i)=>{let o=n.filter(f=>f.isIntersecting);!this.hasScrolled&&!this.initialLoadProcessed?(o.forEach(f=>{let y=f.target;this.loadImageWithStagger(y),i.unobserve(y)}),this.initialLoadProcessed=!0):o.sort((y,T)=>{let d=y.boundingClientRect,S=T.boundingClientRect;return d.top-S.top||d.left-S.left}).forEach((y,T)=>{let d=y.target,S=T*50;this.loadImageWithStagger(d,S),i.unobserve(d)})},{rootMargin:"50px 0px",threshold:.01});e.forEach(n=>{n.dataset.src&&t.observe(n)})}fallbackLoading(e){e.forEach((t,n)=>{if(t.dataset.src)if(n<8)this.loadImageWithStagger(t);else{let i=(n-8)*100;this.loadImageWithStagger(t,i)}})}loadImageWithStagger(e,t=0){if(!e.dataset.src||e.src)return;let n=e.nextElementSibling;e.src=e.dataset.src,e.onload=()=>{setTimeout(()=>{e.classList.remove("opacity-0"),e.classList.add("opacity-100"),n?.classList.contains("book-placeholder")&&(n.style.transition="opacity 0.3s ease-out",n.style.opacity="0",setTimeout(()=>{n.style.display="none"},300))},t+50)},e.onerror=()=>{setTimeout(()=>{e.style.display="none",n?.classList.contains("book-placeholder")&&(n.style.display="flex",n.style.opacity="1")},t)}}loadImageForCard(e){let t=e.querySelector(".lazy-image[data-src]");t&&!t.src&&this.loadImageWithStagger(t)}};window.LazyImageLoader=V;var B=class{constructor(e){this.value=e}valueOf(){return this.value}},g=class extends B{constructor(e="???"){super(e)}toString(e){return`{${this.value}}`}},b=class extends B{constructor(e,t={}){super(e),this.opts=t}toString(e){try{return e.memoizeIntlObject(Intl.NumberFormat,this.opts).format(this.value)}catch(t){return e.reportError(t),this.value.toString(10)}}},I=class extends B{constructor(e,t={}){super(e),this.opts=t}toString(e){try{return e.memoizeIntlObject(Intl.DateTimeFormat,this.opts).format(this.value)}catch(t){return e.reportError(t),new Date(this.value).toISOString()}}};var ie=100,_e="\u2068",xe="\u2069";function Oe(r,e,t){if(t===e||t instanceof b&&e instanceof b&&t.value===e.value)return!0;if(e instanceof b&&typeof t=="string"){let n=r.memoizeIntlObject(Intl.PluralRules,e.opts).select(e.value);if(t===n)return!0}return!1}function oe(r,e,t){return e[t]?H(r,e[t].value):(r.reportError(new RangeError("No default")),new g)}function ee(r,e){let t=[],n=Object.create(null);for(let i of e)i.type==="narg"?n[i.name]=Z(r,i.value):t.push(Z(r,i));return{positional:t,named:n}}function Z(r,e){switch(e.type){case"str":return e.value;case"num":return new b(e.value,{minimumFractionDigits:e.precision});case"var":return Re(r,e);case"mesg":return Me(r,e);case"term":return Ae(r,e);case"func":return Ce(r,e);case"select":return Be(r,e);default:return new g}}function Re(r,{name:e}){let t;if(r.params)if(Object.prototype.hasOwnProperty.call(r.params,e))t=r.params[e];else return new g(`$${e}`);else if(r.args&&Object.prototype.hasOwnProperty.call(r.args,e))t=r.args[e];else return r.reportError(new ReferenceError(`Unknown variable: $${e}`)),new g(`$${e}`);if(t instanceof B)return t;switch(typeof t){case"string":return t;case"number":return new b(t);case"object":if(t instanceof Date)return new I(t.getTime());default:return r.reportError(new TypeError(`Variable type not supported: $${e}, ${typeof t}`)),new g(`$${e}`)}}function Me(r,{name:e,attr:t}){let n=r.bundle._messages.get(e);if(!n)return r.reportError(new ReferenceError(`Unknown message: ${e}`)),new g(e);if(t){let i=n.attributes[t];return i?H(r,i):(r.reportError(new ReferenceError(`Unknown attribute: ${t}`)),new g(`${e}.${t}`))}return n.value?H(r,n.value):(r.reportError(new ReferenceError(`No value: ${e}`)),new g(e))}function Ae(r,{name:e,attr:t,args:n}){let i=`-${e}`,o=r.bundle._terms.get(i);if(!o)return r.reportError(new ReferenceError(`Unknown term: ${i}`)),new g(i);if(t){let f=o.attributes[t];if(f){r.params=ee(r,n).named;let y=H(r,f);return r.params=null,y}return r.reportError(new ReferenceError(`Unknown attribute: ${t}`)),new g(`${i}.${t}`)}r.params=ee(r,n).named;let c=H(r,o.value);return r.params=null,c}function Ce(r,{name:e,args:t}){let n=r.bundle._functions[e];if(!n)return r.reportError(new ReferenceError(`Unknown function: ${e}()`)),new g(`${e}()`);if(typeof n!="function")return r.reportError(new TypeError(`Function ${e}() is not callable`)),new g(`${e}()`);try{let i=ee(r,t);return n(i.positional,i.named)}catch(i){return r.reportError(i),new g(`${e}()`)}}function Be(r,{selector:e,variants:t,star:n}){let i=Z(r,e);if(i instanceof g)return oe(r,t,n);for(let o of t){let c=Z(r,o.key);if(Oe(r,i,c))return H(r,o.value)}return oe(r,t,n)}function te(r,e){if(r.dirty.has(e))return r.reportError(new RangeError("Cyclic reference")),new g;r.dirty.add(e);let t=[],n=r.bundle._useIsolating&&e.length>1;for(let i of e){if(typeof i=="string"){t.push(r.bundle._transform(i));continue}if(r.placeables++,r.placeables>ie)throw r.dirty.delete(e),new RangeError(`Too many placeables expanded: ${r.placeables}, max allowed is ${ie}`);n&&t.push(_e),t.push(Z(r,i).toString(r)),n&&t.push(xe)}return r.dirty.delete(e),t.join("")}function H(r,e){return typeof e=="string"?r.bundle._transform(e):te(r,e)}var j=class{constructor(e,t,n){this.dirty=new WeakSet,this.params=null,this.placeables=0,this.bundle=e,this.errors=t,this.args=n}reportError(e){if(!this.errors||!(e instanceof Error))throw e;this.errors.push(e)}memoizeIntlObject(e,t){let n=this.bundle._intls.get(e);n||(n={},this.bundle._intls.set(e,n));let i=JSON.stringify(t);return n[i]||(n[i]=new e(this.bundle.locales,t)),n[i]}};function W(r,e){let t=Object.create(null);for(let[n,i]of Object.entries(r))e.includes(n)&&(t[n]=i.valueOf());return t}var ae=["unitDisplay","currencyDisplay","useGrouping","minimumIntegerDigits","minimumFractionDigits","maximumFractionDigits","minimumSignificantDigits","maximumSignificantDigits"];function ce(r,e){let t=r[0];if(t instanceof g)return new g(`NUMBER(${t.valueOf()})`);if(t instanceof b)return new b(t.valueOf(),{...t.opts,...W(e,ae)});if(t instanceof I)return new b(t.valueOf(),{...W(e,ae)});throw new TypeError("Invalid argument to NUMBER")}var le=["dateStyle","timeStyle","fractionalSecondDigits","dayPeriod","hour12","weekday","era","year","month","day","hour","minute","second","timeZoneName"];function ue(r,e){let t=r[0];if(t instanceof g)return new g(`DATETIME(${t.valueOf()})`);if(t instanceof I)return new I(t.valueOf(),{...t.opts,...W(e,le)});if(t instanceof b)return new I(t.valueOf(),{...W(e,le)});throw new TypeError("Invalid argument to DATETIME")}var de=new Map;function fe(r){let e=Array.isArray(r)?r.join(" "):r,t=de.get(e);return t===void 0&&(t=new Map,de.set(e,t)),t}var q=class{constructor(e,{functions:t,useIsolating:n=!0,transform:i=o=>o}={}){this._terms=new Map,this._messages=new Map,this.locales=Array.isArray(e)?e:[e],this._functions={NUMBER:ce,DATETIME:ue,...t},this._useIsolating=n,this._transform=i,this._intls=fe(e)}hasMessage(e){return this._messages.has(e)}getMessage(e){return this._messages.get(e)}addResource(e,{allowOverrides:t=!1}={}){let n=[];for(let i=0;i<e.body.length;i++){let o=e.body[i];if(o.id.startsWith("-")){if(t===!1&&this._terms.has(o.id)){n.push(new Error(`Attempt to override an existing term: "${o.id}"`));continue}this._terms.set(o.id,o)}else{if(t===!1&&this._messages.has(o.id)){n.push(new Error(`Attempt to override an existing message: "${o.id}"`));continue}this._messages.set(o.id,o)}}return n}formatPattern(e,t=null,n=null){if(typeof e=="string")return this._transform(e);let i=new j(this,n,t);try{return te(i,e).toString(i)}catch(o){if(i.errors&&o instanceof Error)return i.errors.push(o),new g().toString(i);throw o}}};var re=/^(-?[a-zA-Z][\w-]*) *= */gm,me=/\.([a-zA-Z][\w-]*) *= */y,$e=/\*?\[/y,ne=/(-?[0-9]+(?:\.([0-9]+))?)/y,ke=/([a-zA-Z][\w-]*)/y,he=/([$-])?([a-zA-Z][\w-]*)(?:\.([a-zA-Z][\w-]*))?/y,Fe=/^[A-Z][A-Z0-9_-]*$/,X=/([^{}\n\r]+)/y,Ne=/([^\\"\n\r]*)/y,ge=/\\([\\"])/y,ye=/\\u([a-fA-F0-9]{4})|\\U([a-fA-F0-9]{6})/y,De=/^\n+/,pe=/ +$/,Ke=/ *\r?\n/g,Pe=/( *)$/,He=/{\s*/y,Ee=/\s*}/y,qe=/\[\s*/y,Ye=/\s*] */y,Ue=/\s*\(\s*/y,Ve=/\s*->\s*/y,Ze=/\s*:\s*/y,ze=/\s*,?\s*/y,je=/\s+/y,z=class{constructor(e){this.body=[],re.lastIndex=0;let t=0;for(;;){let s=re.exec(e);if(s===null)break;t=re.lastIndex;try{this.body.push(y(s[1]))}catch(a){if(a instanceof SyntaxError)continue;throw a}}function n(s){return s.lastIndex=t,s.test(e)}function i(s,a){if(e[t]===s)return t++,!0;if(a)throw new a(`Expected ${s}`);return!1}function o(s,a){if(n(s))return t=s.lastIndex,!0;if(a)throw new a(`Expected ${s.toString()}`);return!1}function c(s){s.lastIndex=t;let a=s.exec(e);if(a===null)throw new SyntaxError(`Expected ${s.toString()}`);return t=s.lastIndex,a}function f(s){return c(s)[1]}function y(s){let a=d(),h=T();if(a===null&&Object.keys(h).length===0)throw new SyntaxError("Expected message value or attributes");return{id:s,value:a,attributes:h}}function T(){let s=Object.create(null);for(;n(me);){let a=f(me),h=d();if(h===null)throw new SyntaxError("Expected attribute value");s[a]=h}return s}function d(){let s;if(n(X)&&(s=f(X)),e[t]==="{"||e[t]==="}")return S(s?[s]:[],1/0);let a=U();return a?s?S([s,a],a.length):(a.value=P(a.value,De),S([a],a.length)):s?P(s,pe):null}function S(s=[],a){for(;;){if(n(X)){s.push(f(X));continue}if(e[t]==="{"){s.push(_());continue}if(e[t]==="}")throw new SyntaxError("Unbalanced closing brace");let m=U();if(m){s.push(m),a=Math.min(a,m.length);continue}break}let h=s.length-1,l=s[h];typeof l=="string"&&(s[h]=P(l,pe));let u=[];for(let m of s)m instanceof G&&(m=m.value.slice(0,m.value.length-a)),m&&u.push(m);return u}function _(){o(He,SyntaxError);let s=Y();if(o(Ee))return s;if(o(Ve)){let a=D();return o(Ee,SyntaxError),{type:"select",selector:s,...a}}throw new SyntaxError("Unclosed placeable")}function Y(){if(e[t]==="{")return _();if(n(he)){let[,s,a,h=null]=c(he);if(s==="$")return{type:"var",name:a};if(o(Ue)){let l=L();if(s==="-")return{type:"term",name:a,attr:h,args:l};if(Fe.test(a))return{type:"func",name:a,args:l};throw new SyntaxError("Function names must be all upper-case")}return s==="-"?{type:"term",name:a,attr:h,args:[]}:{type:"mesg",name:a,attr:h}}return k()}function L(){let s=[];for(;;){switch(e[t]){case")":return t++,s;case void 0:throw new SyntaxError("Unclosed argument list")}s.push(R()),o(ze)}}function R(){let s=Y();return s.type!=="mesg"?s:o(Ze)?{type:"narg",name:s.name,value:k()}:s}function D(){let s=[],a=0,h;for(;n($e);){i("*")&&(h=a);let l=M(),u=d();if(u===null)throw new SyntaxError("Expected variant value");s[a++]={key:l,value:u}}if(a===0)return null;if(h===void 0)throw new SyntaxError("Expected default variant");return{variants:s,star:h}}function M(){o(qe,SyntaxError);let s;return n(ne)?s=x():s={type:"str",value:f(ke)},o(Ye,SyntaxError),s}function k(){if(n(ne))return x();if(e[t]==='"')return F();throw new SyntaxError("Invalid expression")}function x(){let[,s,a=""]=c(ne),h=a.length;return{type:"num",value:parseFloat(s),precision:h}}function F(){i('"',SyntaxError);let s="";for(;;){if(s+=f(Ne),e[t]==="\\"){s+=K();continue}if(i('"'))return{type:"str",value:s};throw new SyntaxError("Unclosed string literal")}}function K(){if(n(ge))return f(ge);if(n(ye)){let[,s,a]=c(ye),h=parseInt(s||a,16);return h<=55295||57344<=h?String.fromCodePoint(h):"\uFFFD"}throw new SyntaxError("Unknown escape sequence")}function U(){let s=t;switch(o(je),e[t]){case".":case"[":case"*":case"}":case void 0:return!1;case"{":return Q(e.slice(s,t))}return e[t-1]===" "?Q(e.slice(s,t)):!1}function P(s,a){return s.replace(a,"")}function Q(s){let a=s.replace(Ke,`
`),h=Pe.exec(s)[1].length;return new G(a,h)}}},G=class{constructor(e,t){this.value=e,this.length=t}};var $=null,se=null;async function We(){if(!$)try{let e=await(await fetch("/assets/json/locales.json")).json();$=new q(e.language);for(let t of e.resources){let n=new z(t);$.addResource(n)}}catch(r){console.warn("Failed to load translations:",r),$=new q("en-US")}}var O={async init(){se||(se=We()),await se},get(r,e){if(!$)return r;let t;typeof e=="number"?t={count:e}:t=e;let n=r,i,o=r.indexOf(".");o!==-1&&(n=r.substring(0,o),i=r.substring(o+1));let c=$.getMessage(n);if(!c)return r;let f;return i?f=c.attributes?.[i]:f=c.value,f?$.formatPattern(f,t):r},getLanguage(){return $?.locales[0]||"en-US"}};var p=class{static get(e,t=null){try{let n=localStorage.getItem(this.PREFIX+e);return n===null?t:JSON.parse(n)}catch(n){return console.warn("StorageManager: Failed to parse item",n),t}}static set(e,t){try{localStorage.setItem(this.PREFIX+e,JSON.stringify(t))}catch(n){console.warn("StorageManager: Failed to save item",n)}}static remove(e){localStorage.removeItem(this.PREFIX+e)}};p.PREFIX="koshelf_",p.KEYS={RECAP_FILTER:"recap_filter",STATS_FILTER:"stats_filter",LIBRARY_LIST_BOOKS_FILTER:"library_list_books_filter",LIBRARY_LIST_COMICS_FILTER:"library_list_comics_filter",LIBRARY_LIST_BOOKS_SECTIONS:"library_list_books_sections",LIBRARY_LIST_COMICS_SECTIONS:"library_list_comics_sections",ITEM_DETAIL_BOOKS_SECTIONS:"item_detail_books_sections",ITEM_DETAIL_COMICS_SECTIONS:"item_detail_comics_sections",STATS_ALL_SECTIONS:"stats_all_sections",STATS_BOOKS_SECTIONS:"stats_books_sections",STATS_COMICS_SECTIONS:"stats_comics_sections",RECAP_SORT_NEWEST:"recap_sort_newest",VERSION:"version",SERVER_MODE:"server_mode",RELOAD_COUNT:"reload_count",LAST_RELOAD:"last_reload"};var J=class{constructor(){this.sections=new Map;this.persistenceKey=null;this.persistedState=null;this.init()}async init(){await O.init(),this.persistenceKey=this.resolvePersistenceKey(),this.persistedState=this.persistenceKey?p.get(this.persistenceKey,{})??{}:null,document.querySelectorAll("section[data-name]").forEach(t=>{let n=t.dataset.name;if(!n)return;let i=t.dataset.defaultVisible==="true",o=t.querySelector("button"),c=t.querySelector('[id$="Container"]'),f=o?.querySelector("svg"),y=o?.querySelector("span");o&&c&&f&&y&&(this.sections.set(n,{section:t,button:o,container:c,chevron:f,buttonText:y,defaultVisible:i}),this.setInitialState(n),o.addEventListener("click",()=>{this.toggle(n,{persist:!0})}))})}resolvePersistenceKey(){let e=document.body?.dataset.sectionToggleScope,t=document.body?.dataset.sectionToggleKind;return e==="library-list"?t==="comics"?p.KEYS.LIBRARY_LIST_COMICS_SECTIONS:t==="books"?p.KEYS.LIBRARY_LIST_BOOKS_SECTIONS:null:e==="item-details"?t==="comics"?p.KEYS.ITEM_DETAIL_COMICS_SECTIONS:t==="books"?p.KEYS.ITEM_DETAIL_BOOKS_SECTIONS:null:e==="statistics"?t==="books"?p.KEYS.STATS_BOOKS_SECTIONS:t==="comics"?p.KEYS.STATS_COMICS_SECTIONS:t==="all"?p.KEYS.STATS_ALL_SECTIONS:null:null}savePersistedState(){!this.persistenceKey||!this.persistedState||p.set(this.persistenceKey,this.persistedState)}setInitialState(e){let t=this.sections.get(e);if(!t)return;let{container:n,chevron:i,buttonText:o,defaultVisible:c}=t,f=this.persistedState&&Object.prototype.hasOwnProperty.call(this.persistedState,e)?this.persistedState[e]:null;(f===null?c:f)?(n.classList.remove("hidden"),i.style.transform="rotate(0deg)",o.textContent=O.get("toggle.hide")):(n.classList.add("hidden"),i.style.transform="rotate(-90deg)",o.textContent=O.get("toggle.show"))}toggle(e,t={}){let n=this.sections.get(e);if(!n)return;let{container:i}=n;i.classList.contains("hidden")?this.show(e,t):this.hide(e,t)}show(e,t={}){let n=this.sections.get(e);if(!n)return;let{container:i,chevron:o,buttonText:c}=n;i.classList.remove("hidden"),o.style.transform="rotate(0deg)",c.textContent=O.get("toggle.hide"),(t.persist??!0)&&this.persistedState&&(this.persistedState[e]=!0,this.savePersistedState())}hide(e,t={}){let n=this.sections.get(e);if(!n)return;let{container:i,chevron:o,buttonText:c}=n;i.classList.add("hidden"),o.style.transform="rotate(-90deg)",c.textContent=O.get("toggle.show"),(t.persist??!0)&&this.persistedState&&(this.persistedState[e]=!1,this.savePersistedState())}isVisible(e){let t=this.sections.get(e);return t?!t.container.classList.contains("hidden"):!1}showAll(){this.sections.forEach((e,t)=>{this.show(t)})}hideAll(){this.sections.forEach((e,t)=>{this.hide(t)})}getSectionNames(){return Array.from(this.sections.keys())}restorePersistedOrDefault(){this.sections.forEach((e,t)=>{let n=this.persistedState&&Object.prototype.hasOwnProperty.call(this.persistedState,t)?this.persistedState[t]:null;(n===null?e.defaultVisible:n)?this.show(t,{persist:!1}):this.hide(t,{persist:!1})})}};var Xe={maxRotation:4,transitionDuration:150,perspective:800,hoverScale:1.02,hoverLift:4,shadowBlur:15,shadowOpacity:.2,enableOverlays:!1,overlayFloatZ:10,overlayScale:1.05,parallaxMultiplier:.3,overlayContainer:".aspect-book",badgeSelector:'[class*="absolute"][class*="top-"]',progressBarSelector:".book-progress-bar"};function Ge(r){if(window.matchMedia("(prefers-reduced-motion: reduce)").matches||!window.matchMedia("(pointer: fine)").matches)return;let e={...Xe,...r};document.querySelectorAll(e.selector).forEach(n=>{n.style.transformStyle="preserve-3d",n.style.transformOrigin="center center",n.style.willChange="transform, box-shadow",n.style.backfaceVisibility="hidden",n.style.transform="translateZ(0)";let i=null,o=null,c=null;e.enableOverlays&&e.overlayContainer&&(i=n.querySelector(e.overlayContainer),i&&(i.style.transformStyle="preserve-3d",i.style.backfaceVisibility="hidden"),o=n.querySelectorAll(e.badgeSelector),c=n.querySelector(e.progressBarSelector),o?.forEach(d=>{d.style.willChange="transform",d.style.backfaceVisibility="hidden",d.style.transform="translateZ(0)"}),c&&(c.style.willChange="transform",c.style.backfaceVisibility="hidden",c.style.transform="translateZ(0)"));let f=null,y=null;n.addEventListener("mouseenter",()=>{n.style.transition=`transform ${e.transitionDuration}ms ease-out, box-shadow ${e.transitionDuration}ms ease-out`,n.style.boxShadow=`0px 8px ${e.shadowBlur}px rgba(0, 0, 0, ${e.shadowOpacity*.5})`,e.enableOverlays&&o&&o.forEach(d=>{d.style.transition=`transform ${e.transitionDuration}ms ease-out`,d.style.transform=`translateZ(${e.overlayFloatZ}px) scale(${e.overlayScale})`}),e.enableOverlays&&c&&(c.style.transition=`transform ${e.transitionDuration}ms ease-out`,c.style.transform=`translateZ(${e.overlayFloatZ}px)`)});let T=()=>{if(!y)return;let d=y,S=n.getBoundingClientRect(),_=(d.clientX-S.left)/S.width,Y=(d.clientY-S.top)/S.height,L=(.5-_)*2*e.maxRotation,R=(Y-.5)*2*e.maxRotation,D=-L*1.5,M=R*1.5+8;if(n.style.transition=`transform ${e.transitionDuration}ms ease-out, box-shadow ${e.transitionDuration}ms ease-out`,n.style.transform=`perspective(${e.perspective}px) rotateX(${R}deg) rotateY(${L}deg) scale(${e.hoverScale}) translateY(-${e.hoverLift}px) translateZ(0)`,n.style.boxShadow=`${D}px ${M}px ${e.shadowBlur}px rgba(0, 0, 0, ${e.shadowOpacity})`,e.enableOverlays){let k=L*e.parallaxMultiplier,x=-R*e.parallaxMultiplier;o?.forEach(F=>{F.style.transform=`translateZ(${e.overlayFloatZ}px) translate(${k}px, ${x}px) scale(${e.overlayScale})`}),c&&(c.style.transform=`translateZ(${e.overlayFloatZ}px) translateX(${k}px)`)}y=null,f=null};n.addEventListener("mousemove",d=>{y=d,f||(f=requestAnimationFrame(T))}),n.addEventListener("mouseleave",()=>{f&&(cancelAnimationFrame(f),f=null,y=null),n.style.transition=`transform ${e.transitionDuration*2}ms ease-out, box-shadow ${e.transitionDuration*2}ms ease-out`,n.style.transform="translateZ(0)",n.style.boxShadow="",e.enableOverlays&&(o?.forEach(d=>{d.style.transition=`transform ${e.transitionDuration*2}ms ease-out`,d.style.transform="translateZ(0)"}),c&&(c.style.transition=`transform ${e.transitionDuration*2}ms ease-out`,c.style.transform="translateZ(0)"))})})}function Se(){Ge({selector:".book-card",enableOverlays:!0})}var be={all:"filter.all-aria",reading:"filter.reading-aria",completed:"filter.completed-aria",abandoned:"filter.on-hold-aria",unread:"filter.unread-aria"};function Je(r){return be[r]??be.all}function ve(r,e){if(!r)return;let t=O.get(Je(e));r.title=t,r.setAttribute("aria-label",t)}function we(r,e){r&&(e==="all"?(r.classList.remove("text-primary-500"),r.classList.add("text-gray-600","dark:text-gray-300")):(r.classList.remove("text-gray-600","dark:text-gray-300"),r.classList.add("text-primary-500")))}function Te(r){return r?r.value.toLowerCase().trim():""}document.addEventListener("DOMContentLoaded",async()=>{await O.init();let r=document.getElementById("searchInput"),e=document.getElementById("mobileSearchInput"),t=document.querySelectorAll("[data-filter]"),n=document.querySelector("section:has(#readingContainer)"),i=document.querySelector("section:has(#completedContainer)"),o=document.querySelector("section:has(#abandonedContainer)"),c=document.querySelector("section:has(#unreadContainer)"),f=document.querySelectorAll(".book-card"),T=(document.body.dataset.sectionToggleKind||"books")==="comics"?p.KEYS.LIBRARY_LIST_COMICS_FILTER:p.KEYS.LIBRARY_LIST_BOOKS_FILTER,d=p.get(T,"all")||"all";new V().init();let _=new J;Se(),window.bookListSections=_;let L=new URLSearchParams(window.location.search).get("search");if(L){r&&(r.value=L),e&&(e.value=L);let l=new URL(window.location.href);l.searchParams.delete("search"),window.history.replaceState({},document.title,l.toString()),setTimeout(()=>{D(L)},100)}let R="";function D(l){let u=l.toLowerCase().trim();!u&&R&&_.restorePersistedOrDefault(),R=u,M(u,d),u&&["reading","completed","abandoned","unread"].forEach(m=>{let v=document.getElementById(m+"Container");if(!v)return;Array.from(v.children).some(A=>A.style.display!=="none")?_.show(m,{persist:!1}):_.hide(m,{persist:!1})})}[r,e].forEach(l=>{l&&l.addEventListener("input",u=>{let m=u.currentTarget;m===r&&e&&(e.value=m.value),m===e&&r&&(r.value=m.value),D(m.value)})}),t.forEach(l=>{l.addEventListener("click",function(){t.forEach(m=>m.classList.remove("filter-button-active")),this.classList.add("filter-button-active"),d=this.dataset.filter||"all",p.set(T,d);let u=Te(r);M(u,d)})});function M(l,u){let m=0,v=0,N=0,A=0;if(f.forEach(E=>{let w=(E.dataset.title||"").toLowerCase(),Le=(E.dataset.author||"").toLowerCase(),Ie=(E.dataset.series||"").toLowerCase(),C=E.dataset.status||"";(!l||w.includes(l)||Le.includes(l)||Ie.includes(l))&&(u==="all"||u==="reading"&&C==="reading"||u==="completed"&&C==="completed"||u==="abandoned"&&C==="abandoned"||u==="unread"&&C==="unread")?(E.style.display="block",E.style.opacity="0",E.style.transform="translateY(20px)",requestAnimationFrame(()=>{E.style.transition="opacity 0.3s ease, transform 0.3s ease",E.style.opacity="1",E.style.transform="translateY(0)"}),C==="reading"&&m++,C==="completed"&&v++,C==="abandoned"&&N++,C==="unread"&&A++):E.style.display="none"}),n){let E=m>0&&(u==="all"||u==="reading");n.style.display=E?"block":"none";let w=n.querySelector('span[class*="bg-gradient"]');w&&(w.textContent=String(m))}if(i){let E=v>0&&(u==="all"||u==="completed");i.style.display=E?"block":"none";let w=i.querySelector('span[class*="bg-gradient"]');w&&(w.textContent=String(v))}if(o){let E=N>0&&(u==="all"||u==="abandoned");o.style.display=E?"block":"none";let w=o.querySelector('span[class*="bg-gradient"]');w&&(w.textContent=String(N))}if(c){let E=A>0&&(u==="all"||u==="unread");c.style.display=E?"block":"none";let w=c.querySelector('span[class*="bg-gradient"]');w&&(w.textContent=String(A))}k(m+v+N+A)}function k(l){let u=document.getElementById("dynamicEmptyState");l===0?u?.classList.remove("hidden"):u?.classList.add("hidden")}let x=document.getElementById("mobileSearchButton"),F=document.getElementById("mobileSearchContainer"),K=document.getElementById("mobileSearchClose"),U=document.getElementById("mobileTitle"),P=document.getElementById("mobileFilterControls");document.addEventListener("keydown",l=>{if(l.key==="/"&&!l.ctrlKey&&!l.metaKey&&!l.altKey&&(l.preventDefault(),window.innerWidth<640?x?.click():r&&r.focus()),l.key==="Escape"&&(document.activeElement===r&&r&&(r.value="",r.dispatchEvent(new Event("input")),r.blur()),F?.classList.contains("hidden")||K?.click()),l.altKey)switch(l.key){case"1":l.preventDefault(),document.querySelector('[data-filter="all"]')?.click();break;case"2":l.preventDefault(),document.querySelector('[data-filter="reading"]')?.click();break;case"3":l.preventDefault(),document.querySelector('[data-filter="completed"]')?.click();break;case"4":l.preventDefault(),document.querySelector('[data-filter="abandoned"]')?.click();break}}),document.querySelectorAll(".book-progress-bar").forEach(l=>{let u=l.style.width;l.style.width="0%",setTimeout(()=>{l.style.transition="width 1s ease-out",l.style.width=u},100)});let s=document.getElementById("filterDropdownButton"),a=document.getElementById("filterDropdownMenu"),h=document.getElementById("selectedFilterLabel");if(s?.addEventListener("click",()=>{a?.classList.toggle("hidden")}),a?.addEventListener("click",l=>{let u=l.target;if(u.matches("button[data-filter]")){let m=u.textContent,v=u.dataset.filter||"all";h&&m&&(h.textContent=m),d=v,p.set(T,d);let N=document.getElementById("filterIcon");we(N,v),ve(s,v);let A=Te(r);M(A,d),a.classList.add("hidden")}}),x?.addEventListener("click",()=>{U?.classList.add("hidden"),x?.classList.add("hidden"),P?.classList.add("hidden"),F?.classList.remove("hidden"),K?.classList.remove("hidden"),setTimeout(()=>e?.focus(),50)}),K?.addEventListener("click",()=>{U?.classList.remove("hidden"),x?.classList.remove("hidden"),P?.classList.remove("hidden"),F?.classList.add("hidden"),K?.classList.add("hidden"),e&&(e.value=""),r&&(r.value="",r.dispatchEvent(new Event("input")))}),d!=="all"){let l=document.querySelector(`#filterDropdownMenu button[data-filter="${d}"]`);l&&h&&(h.textContent=l.textContent);let u=document.getElementById("filterIcon");we(u,d),ve(s,d);let m=document.querySelector(`[data-filter="${d}"]`);m&&(t.forEach(v=>v.classList.remove("filter-button-active")),m.classList.add("filter-button-active")),M("",d)}});
